\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{commons}
\RequirePackage{amsmath}
%\RequirePackage[intlimits]{amsmath}


\RequirePackage{braket}
\RequirePackage{siunitx}
\RequirePackage{amsfonts}
\RequirePackage{amsthm}
\RequirePackage{amsxtra}
\RequirePackage{amssymb}
\RequirePackage{mathdots}
\RequirePackage{mathrsfs}
\RequirePackage{cleveref}

\usepackage{tcolorbox}
\newcommand{\important}[1] {
	\begin{tcolorbox}#1\end{tcolorbox}}

%%%%%%%%%%%%%%%%%%%% CODE ENVIRONMENTS %%%%%%%%%%%%%%%%%%%%%

\usepackage{listings,xcolor}


\lstset{language=Mathematica}
\lstset{basicstyle={\sffamily\footnotesize},
	numbers=left,
	numberstyle=\tiny\color{gray},
	numbersep=5pt,
	breaklines=true,
	captionpos={t},
	frame={lines},
	rulecolor=\color{black},
	framerule=0.5pt,
	columns=flexible,
	tabsize=2
}


\lstdefinelanguage{Julia}%
  {morekeywords={abstract,break,case,catch,const,continue,do,else,elseif,%
      end,export,false,for,function,immutable,import,importall,if,in,%
      macro,module,otherwise,quote,return,switch,true,try,type,typealias,%
      using,while},%
   sensitive=true,%
   alsoother={$},%
   morecomment=[l]\#,%
   morecomment=[n]{\#=}{=\#},%
   morestring=[s]{"}{"},%
   morestring=[m]{'}{'},%
}[keywords,comments,strings]%
\definecolor{ForestGreen}{RGB}{34,139,34} 
\lstset{%
    language         = Julia,
    basicstyle       = \ttfamily,
    keywordstyle     = \bfseries\color{blue},
    stringstyle      = \color{magenta},
    commentstyle     = \color{ForestGreen},
    showstringspaces = false,
}

\definecolor{BackgroundGreen}{HTML}{E6F0F0}
\definecolor{NoteBackground}{HTML}{FFFCE3}
\definecolor{BackgroundBeige}{HTML}{FDF6E3}
\definecolor{BackgroundYellow}{HTML}{FEFBDF}
\definecolor{SolarizedGrey}{HTML}{657B83}
\definecolor{CornellRed}{HTML}{B31B1B}
\definecolor{CppGold}{HTML}{b38000}
\definecolor{PythonBlue}{HTML}{3675a9} 
\definecolor{Red}{HTML}{ff0000} 


\lstdefinelanguage{Matlab}{%
  % Basic settings
  basicstyle={\sffamily\footnotesize},
  tabsize=4,
  showstringspaces=false,
  mathescape=true,
  breaklines=true,
  numbers=left,
  % Keywords, strings, and comments
  keywords={%
    break, case, catch, classdef, continue, else, elseif, end, for, function,
    global, if, otherwise, parfor, persistent, return, spmd, switch, try, while
  },
  keywords=[2]{%
  },
  morestring=[b]',
  morecomment=[l]{\%},
  % Colors and style
  keywordstyle=\color{blue},
  keywordstyle=[2]\color{DarkOrchid},
  commentstyle=\color{ForestGreen},
  stringstyle=\color{Red},
  numberstyle=\color{SolarizedGrey}
}

%%%%%%%%%%%%%%%%%%% PICTURES, PLOTS, CODE FILES %%%%%%%%%%%%%%%%%%%%%


%https://tex.stackexchange.com/questions/17734/cannot-determine-size-of-graphic
%\usepackage[dvipdfmx]{graphicx} 
%\usepackage{bmpsize}
%\graphicspath{ {./figures/} }
\usepackage{calc}
\newlength{\imgwidth}
\usepackage{wrapfig}

\newcommand{\pngfig}[2]{
    \settowidth{\imgwidth}{\includegraphics{figures/#1.png}}%
    \setlength{\imgwidth}{\minof{\imgwidth}{\textwidth}}%

    % \ifdimless{\imgwidth}{0.5\textwidth}}{
    %     \begin{wrapfigure}{r}{0.5\textwidth}
    %         \centering
    %         \includegraphics[width=\imgwidth,keepaspectratio=true]{figures/#1.png}
    %         %\includegraphics[width=0.9\textwidth,height=0.5\textheight,keepaspectratio=true]{figures/#1.png}
    %         \caption{#2\label{fig:#1}}
    %     \end{wrapfigure}
    % }{
        \begin{figure}%{r}{\imgwidth}
            \centering
            \includegraphics[width=\imgwidth,keepaspectratio=true]{figures/#1.png}
            %\includegraphics[width=0.9\textwidth,height=0.5\textheight,keepaspectratio=true]{figures/#1.png}
            \caption{#2\label{fig:#1}}
            \vspace{-5pt}
        \end{figure}
    % }

}

\newcommand{\pdffig}[2]{
    \begin{figure}
        \begin{center}
        \includegraphics[width=0.9\linewidth,height=0.5\textheight,keepaspectratio=true]{figures/#1.pdf}
        \caption{#2\label{fig:#1}}
        \end{center}
    \end{figure}
}

\newcommand{\epsfig}[2]{
    \begin{figure}
        \begin{center}
        \includegraphics[width=0.9\linewidth,height=0.5\textheight,keepaspectratio=true]{figures/#1.eps}
        \caption{#2\label{fig:#1}}
        \end{center}
    \end{figure}
}


%\newcommand{\svgfig}[2]{
%    \begin{figure}
%        \begin{center}
%        \includegraphics[width=0.9\linewidth,height=0.5\textheight,keepaspectratio=true]{figures/#1.svg}
%        \caption{#2\label{fig:#1}}
%        \end{center}
%    \end{figure}
%}

\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}
\usepackage{xargs}   

\newcommand{\pdftexfig}[2]{%
	\begin{figure}
	    \begin{center}
            \def\svgwidth{0.6\columnwidth}
            \import{./figures/}{#1.pdf_tex}
            \caption{#2\label{fig:#1}}
        \end{center}
	\end{figure}
}

\usepackage{pgfplots} 
\pgfplotsset{compat=1.16}
\RequirePackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{patterns}
\usetikzlibrary{shapes}
\usetikzlibrary{intersections}
\usetikzlibrary{backgrounds}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{external}
\tikzexternalize[prefix=figures/]

\newcommand{\tikzfig}[2]{
    %\tikzexternalenable % Enable externalization
	\begin{figure}
	    \begin{centering}
            %\begin{scaletikzpicturetowidth}{\textwidth}
            %\begin{tikzpicture}[scale=\tikzscale]
            %\tikzsetnextfilename{#1}
            \resizebox{0.3\textwidth}{!}{
                \begin{tikzpicture}
                    \input{./figures/#1.tikz}
                \end{tikzpicture}
                % \includegraphics{figures/example_figure.pdf}
            }		
            \caption{#2\label{fig:#1}}
            
            %\end{tikzpicture}
            %\end{scaletikzpicturetowidth}
        \end{centering}
    \end{figure}
    %\tikzexternaldisable
}

%\usepackage{tikz}
%\usepackage{tikzscale}
%
%\newcommand{\tikzfigscale}[2]{
%	\begin{figure}
%		\begin{center}
%		\includegraphics[width=0.6\linewidth]{./figures/#1.tikz}
%			\caption{#2\label{fig:#1}}
%		\end{center}
%	\end{figure}
%}
%

%\usepackage{environ}
%\makeatletter
%\newsavebox{\measure@tikzpicture}
%\NewEnviron{scaletikzpicturetowidth}[1]{%
%  \def\tikz@width{#1}%
%  \def\tikzscale{1}\begin{lrbox}{\measure@tikzpicture}%
%  \BODY
%  \end{lrbox}%
%  \pgfmathparse{#1/\wd\measure@tikzpicture}%
%  \edef\tikzscale{\pgfmathresult}%
%  \BODY
%}



%%%%%%%%%%%%%%%%%%% CUBICAL TYPE THEORY %%%%%%%%%%%%%%%%%%%%%

\global\long\def\evidence#1{\left\llbracket#1\right\rrbracket}
\newcommand{\form}[1]{\scalebox{1.087}{\boldmath{#1}}}
\global\long\def\ctx{\text{Ctx}}%
\global\long\def\set{\text{\textbf{Set}}}%
\global\long\def\ty#1{\text{Ty}\left(#1\right)}%
\global\long\def\tm#1#2{\text{Tm}\left(#1,#2\right)}%

%\newcommand{\psh}[1]{\text{Psh}\left(#1\right)}
\newcommand{\psh}[1]{\widehat{#1}}
\newcommand{\singleton}[0]{\left\{ \star \right\}}
\newcommand{\coe}[2]{\int_{#1}{#2}}
\newcommand{\homo}[3]{\text{Hom}_{#1}\left(#2,#3\right)}
%\newcommand{\op}[1]{\textfrak{#1}}
\newcommand{\op}[1]{\mathtt{#1}}

\newcommand{\cube}[0]{\textbf{Cb}}

%\newcommand{\type}{\text{\textbf{T}}}
\newcommand{\type}{\mathcal{U}}
\newcommand{\cpath}[3]{\op{Path}_{#1}\left(#2, #3\right)}
\newcommand{\compt}[5]{\op{comp}^{#1} \ {#2} \ \left[{#3} \mapsto {#4} \right] \ {#5}}
\newcommand{\fillt}[5]{\op{fill}^{#1} \ {#2} \ \left[{#3} \mapsto {#5} \right] \ {#5}}

\newcommand{\isequiv}[3]{\op{isEquiv} \ #1 \ #2 \ #3}


%%%%%%%%%%%%%%%%%%%%% REMARKS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\file}[1]{\marginpar{#1}}


%%%%%%%%%%%%%%%%%%%%% EMPTY SPACE FOR STUDENTS %%%%%%%%%%
%https://tex.stackexchange.com/questions/76483/page-breaks-within-enumerated-list
\usepackage{enumitem}
\newlength{\currentparskip}
% https://tex.stackexchange.com/questions/56435/replace-item-with-myitem-to-box-each-list-member-with-an-mdframed
\newcommand{\MyItem}{\item}
\newtoggle{FirstItem}%
\toggletrue{FirstItem}
\toggletrue{FirstItem}%
\newenvironment{MyEnumerate}[1][]{%
    \renewcommand{\MyItem}{%
        \iftoggle{FirstItem}{%
            \global\togglefalse{FirstItem}
            \setlength{\currentparskip}{\parskip}% save the value
            %--------- start new minipage
            \par\addvspace{\baselineskip}\noindent
            \begin{minipage}{\textwidth}%
            \setlength{\parskip}{\currentparskip}% restore the value
            \begin{enumerate}[#1,series=MySeries]%
        }{%
            \end{enumerate}%
            \end{minipage}%
            %--------- end previous minipage and start new one
            \par\addvspace{\baselineskip}\noindent
            \begin{minipage}{\textwidth}%
            \setlength{\parskip}{\currentparskip}% restore the value
            \begin{enumerate}[#1,resume*=MySeries]%
        }%
        \item\mbox{}%
    }%
}{%
    \end{enumerate}%
    \end{minipage}% --------- end last minipage
    \global\toggletrue{FirstItem}%
}%



% for writing division tables
\usepackage{xlop}

% this is the space a student needs to write one digit
\newcommand*{\mystrut}{\phantom{\rule[-0.05\baselineskip]{1.2mm}{1.2\baselineskip}}}
%\newcommand*{\mybox}[1]\textcolor{black!40{\framebox{#1}}
\newcommand*{\mybox}[1]{\textcolor{black!40}{\framebox{\textcolor{black!100}{#1}}}}
\newcommand{\placeholder}[1]{\mystrut}% Print -- regardless of the input
\newcommand{\gobble}[1]{}% Print <nothing> regardless of the input

% \newcommand{\derivblank}[2]{%
%     \noindent
%     \begin{align*}
%     \xderivblank{#1}{#2}%
% &#2  \hspace{0.2cm}  \mybox{\underline{ \mystrut  \hspace{0.5 \linewidth }}  $\approx$ \underline{ \hspace{0.2\linewidth}}}
%     \end{align*}
% }

\newcommand{\derivblank}[2]{%
    %\noindent
    \begin{equation*}
    \begin{aligned}[t] 
    \xderivblank{#1}{#2}%
&#2  \hspace{0.2cm}  \mybox{\underline{ \mystrut  \hspace{0.8 \linewidth }}  }
    \end{aligned}
    \end{equation*}
}


\newcommand\xderivblank[2]{%
\ifnum#1=0 \else
        &#2 \hspace{0.2cm}\underline{\mystrut\hspace{0.8 \linewidth}}  \\
\xderivblank{\numexpr#1-1}{#2}\fi}


\newcommand{\derivblanksolution}[2]{%
    \noindent
    \begin{align*}
&=  \hspace{0.2cm}  \mybox{ #1 \hspace{0.05 \linewidth}  $\approx$ #2 \hspace{0.05 \linewidth}}
    \end{align*}
}

\newcommand{\emptyrows}[2]{%
    \noindent
    \begin{tabular}{ c|c } 
        &  \mystrut  \\
        #2 &  \mystrut \\\cline{1-1}
        \xemptyrows{#1}%
        &  \mystrut  
    \end{tabular}
    %\mybox{$#2 = $ \underline{\hspace{0.2 \linewidth}}}
}
\newcommand\xemptyrows[1]{%
\ifnum#1=0 \else
         &  \mystrut  \\
\xemptyrows{\numexpr#1-1}\fi}



%%%%%%%%%%%%%%%%%%%% ABBREVIATIONS %%%%%%%%%%%%%%%%%%%%
\newcommand{\pha}{{}_\bullet}
\newcommand{\phb}{{}_\blacktriangle}
\newcommand{\phc}{\blacktriangle}

\newcommand{\dotleq}{\mathrel{\raisebox{1.2ex}{$⋅$}\mkern-13.5mu \leq}}
\renewcommand{\projlim}{\varprojlim}
\renewcommand{\injlim}{\varinjlim}
\newcommand{\dottimes}{\stackrel[\cdot]{\times}}

%\newcommand{\xra}[1]{\xrightarrow{#1}}
\newcommand{\xra}[1]{\, \tikz[baseline] \draw (0pt,3.5pt) -- (7pt,3.5pt); {\raisebox{1.5pt}{\ensuremath{\scriptstyle #1}}} \tikz[baseline] \draw [->] (0pt,3.5pt) -- (7pt,3.5pt); \, }

\let\tempCaption=\caption
\renewcommand{\caption}[1]{\itshape \tempCaption{#1}}

\renewcommand{\obar}[1]{\overline{#1}}
\newcommand{\ubar}[1]{\underline{#1}}

%%%%%%%%%%%% BRACKETS AND NORMS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\pa}[1]{\left(#1\right)}
%\newcommand{\ang}[1]{\left<#1\right>}
%\newcommand{\bra}[1]{\left[#1\right]}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\norm}[1]{\left\|#1\right\|}

\newcommand{\mat}[1]{\begin{matrix}#1\end{matrix}}
\newcommand{\pmat}[1]{\pa{\mat{#1}}}
\newcommand{\bmat}[1]{\bra{\mat{#1}}}
\newcommand{\sismat}[1]{\left\{\mat{#1}\right.}
\newcommand{\sm}[1]{\begin{smallmatrix}#1\end{smallmatrix}}
\newcommand{\psm}[1]{\pa{\sm{#1}}}
\newcommand{\bsm}[1]{\bra{\sm{#1}}}
\newcommand{\tci}[2]{\set{\,#1 \mid{} #2\,}}
\newcommand{\tcia}[2]{\ang{\,#1 \mid{} #2\,}}
\newcommand{\pfrac}[2]{\pa{\frac{#1}{#2}}}
\newcommand{\bfrac}[2]{\bra{\frac{#1}{#2}}}
\newcommand{\psfrac}[2]{\pa{\sfrac{#1}{#2}}}
\newcommand{\bsfrac}[2]{\bra{\sfrac{#1}{#2}}}


%%%%%%%%%%%% DERIVATIVES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\der}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pder}[2]{\pfrac{\partial #1}{\partial #2}}
\newcommand{\sder}[2]{\sfrac{\partial #1}{\partial #2}}
\newcommand{\psder}[2]{\psfrac{\partial #1}{\partial #2}}
\newcommand{\coder}[2]{\nabla_{#1}{#2}}
\newcommand{\nder}[2]{\frac{d #1}{d #2}}

%%%%%%%%%%%%%%%%%% SUBGROUPS AND COMMUTATORS %%%%%%%%%%%%%%%%%
\newcommand{\leg}[2]{\pfrac{#1}{#2}}
\newcommand{\estdim}[2]{\left[#1 : #2\right]}
\newcommand{\abel}[2]{\left[#1, #2\right]}
\newcommand{\brk}[2]{\left[#1,#2\right]}

%%%%%%%%%%%%%%%%%%%% ALGEBRAIC OPERATORS %%%%%%%%%%%%%%%%%%%%
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Schemes}{\mathfrak{Sch}}
\DeclareMathOperator{\AffineSchemes}{\mathfrak{AffSch}}
\DeclareMathOperator{\Sets}{\mathfrak{Sets}}
\DeclareMathOperator{\Groupoids}{\mathfrak{Groupoids}}
\DeclareMathOperator{\TopologicalSpaces}{\mathfrak{Top}}

\DeclareMathOperator{\Alb}{Alb}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\B}{B}
\DeclareMathOperator{\cod}{cod}
\DeclareMathOperator{\de}{d}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\Div}{Div}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Fix}{Fix}
\DeclareMathOperator{\gen}{g}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\Hilb}{Hilb}
\DeclareMathOperator{\Ho}{H}
\DeclareMathOperator{\ho}{h}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Image}{Im}
\DeclareMathOperator{\Isom}{Isom}
\DeclareMathOperator{\Mod}{Mod}
\DeclareMathOperator{\Mor}{Mor}
\DeclareMathOperator{\argen}{p_a}
\DeclareMathOperator{\geomgen}{p_g}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\Projection}{Proj}
\DeclareMathOperator{\irr}{q}
\DeclareMathOperator{\res}{res}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Sing}{Sing}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Stab}{Stab}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\Tors}{Tors}
\DeclareMathOperator{\vp}{v.p.}


%%%%%%%%%%%%%%%%%%%% LETTERS %%%%%%%%%%%%%%%%%%%%
\newcommand{\frakM}{\mathfrak{M}}
\newcommand{\frakm}{\mathfrak{m}}
